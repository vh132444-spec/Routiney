<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆì´ ë£¨í‹´ ë§¤ë‹ˆì € Pro</title>
    
    <!-- ì•„ì´í° í™ˆ í™”ë©´ ì¶”ê°€ ì‹œ ì•„ì´ì½˜ ë° ì•± ì„¤ì • -->
    <link rel="apple-touch-icon" href="https://imgnn.seoul.co.kr/img/upload/2014/05/30/SSI_20140530134057.jpg">
    <meta name="apple-mobile-web-app-title" content="ë£¨í‹´ë§¤ë‹ˆì €">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë¡œë”© ìµœì í™” -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@800;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
        
        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f8fafc; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-font-smoothing: antialiased;
        }
        
        .logo-font { 
            font-family: 'Outfit', 'Inter', 'system-ui', sans-serif !important; 
            font-weight: 800;
            letter-spacing: -0.04em; 
            text-transform: uppercase;
        }
        
        .checked { text-decoration: line-through; opacity: 0.6; }
        .active-task { border: 2px solid #6366f1 !important; transform: scale(1.01); box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .urgent-bg {
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%) !important;
            animation: pulse-red 3s infinite;
        }
        @keyframes pulse-red {
            0% { opacity: 1; }
            50% { opacity: 0.92; }
            100% { opacity: 1; }
        }

        button:active { transform: scale(0.96); transition: 0.1s; }

        /* íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .tab-active {
            color: #4f46e5 !important; /* indigo-600 */
            border-bottom: 2px solid #4f46e5 !important;
        }
        .tab-inactive {
            color: #94a3b8 !important; /* slate-400 */
            border-bottom: 2px solid transparent !important;
        }
    </style>
</head>
<body class="pb-10 select-none bg-slate-50">

    <div class="max-w-md mx-auto min-h-screen shadow-2xl flex flex-col relative bg-white">
        
        <!-- ìƒë‹¨ í—¤ë” -->
        <div id="header-section" class="pt-7 pb-5 px-5 bg-indigo-600 text-white sticky top-0 z-30 shadow-md transition-colors duration-500">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h1 class="text-2xl logo-font leading-none flex items-center gap-2">
                        MY ROUTINE
                        <span id="event-tag" class="hidden text-[10px] bg-yellow-400 text-black px-2 py-0.5 rounded-full font-black animate-bounce">EVENT</span>
                    </h1>
                    <p id="today-date-display" class="text-[11px] opacity-80 font-medium mt-1"></p>
                    <p id="header-alert-msg" class="text-[11px] font-black text-yellow-200 mt-2 hidden leading-tight"></p>
                </div>
                <div class="flex flex-col items-end">
                    <button onclick="setExamDate()" id="d-day-display" class="bg-white/20 px-3 py-1 rounded-full text-xs font-black border border-white/20 active:scale-95 transition-all mb-2"></button>
                </div>
            </div>

            <!-- ë°ì¼ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
            <div class="bg-black/10 rounded-xl p-3 border border-white/10">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] font-black opacity-70 uppercase tracking-widest">Daily Essentials</span>
                    <button onclick="addNewEssential()" class="text-[10px] bg-white/20 hover:bg-white/30 px-2 py-0.5 rounded font-bold">+ ì¶”ê°€</button>
                </div>
                <div id="essentials-list" class="grid grid-cols-2 gap-x-3 gap-y-1.5 max-h-24 overflow-y-auto no-scrollbar"></div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <div class="flex bg-white border-b border-slate-100 sticky top-0 z-20 shadow-sm">
            <button onclick="switchTab('today')" id="tab-today" class="flex-1 py-4 text-sm font-bold tab-active">íƒ€ì„ë¼ì¸</button>
            <button onclick="switchTab('stats')" id="tab-stats" class="flex-1 py-4 text-sm font-bold tab-inactive">ë¶„ì„</button>
            <button onclick="switchTab('edit')" id="tab-edit" class="flex-1 py-4 text-sm font-bold tab-inactive">ê´€ë¦¬</button>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="flex-1 overflow-y-auto no-scrollbar bg-slate-50/50">
            <div id="content-today" class="tab-content active p-4">
                <div class="space-y-4 pb-12">
                    <div class="flex gap-2">
                        <div id="status-msg" class="flex-1 text-[11px] font-bold text-indigo-600 bg-indigo-50 p-2.5 rounded-xl border border-indigo-100 text-center shadow-sm flex items-center justify-center"></div>
                        <button id="rest-btn" onclick="toggleRestDay()" class="px-4 py-2 bg-slate-800 text-white text-[10px] font-black rounded-xl active:scale-95 transition-all whitespace-nowrap">ì „ì²´ íœ´ì‹</button>
                    </div>
                    
                    <div id="routine-container" class="relative">
                        <div id="routine-list" class="space-y-2.5"></div>
                        <div id="rest-view" class="hidden py-16 text-center flex flex-col items-center justify-center bg-white rounded-3xl border border-slate-200 shadow-sm border-dashed">
                            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4"><span class="text-3xl">â˜•ï¸</span></div>
                            <h2 class="text-xl font-black text-slate-800">ì˜¤ëŠ˜ì€ íœ´ì‹ ëª¨ë“œì…ë‹ˆë‹¤</h2>
                            <button onclick="toggleRestDay()" class="mt-6 px-6 py-2 bg-indigo-600 text-white text-[11px] font-bold rounded-full shadow-lg">ë£¨í‹´ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="content-stats" class="tab-content p-6 min-h-full">
                <h3 class="font-bold text-slate-800 mb-6 text-sm uppercase tracking-tight">ì£¼ê°„ ì„±ì·¨ë„</h3>
                <div id="weekly-chart" class="flex items-end justify-between h-32 gap-2 mb-10 px-2 border-b border-slate-100 pb-2"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                        <p class="text-[10px] text-slate-400 mb-1 font-bold uppercase">í‰ê·  ë‹¬ì„±ë¥ </p>
                        <h2 id="avg-rate" class="text-xl font-black text-indigo-600">0%</h2>
                    </div>
                    <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                        <p class="text-[10px] text-slate-400 mb-1 font-bold uppercase">ì—°ì† ì„±ê³µ</p>
                        <h2 id="streak-days" class="text-xl font-black text-rose-500">0ì¼</h2>
                    </div>
                </div>
            </div>

            <div id="content-edit" class="tab-content p-5 space-y-8 min-h-full">
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <h3 class="font-black text-slate-800 text-xs uppercase tracking-tight">ğŸ“… ì¤‘ìš” ì¼ì • ê´€ë¦¬</h3>
                        <button onclick="addSchedule()" class="text-[10px] bg-slate-800 text-white px-3 py-1 rounded-full font-bold">+ ì¶”ê°€</button>
                    </div>
                    <div id="full-schedule-list" class="space-y-2"></div>
                </div>
                <div class="space-y-3 pt-6 border-t border-slate-100">
                    <div class="flex justify-between items-center">
                        <h3 class="font-black text-slate-800 text-xs uppercase tracking-tight">â° ë£¨í‹´ í¸ì§‘</h3>
                        <button onclick="addNewRoutine()" class="text-[10px] bg-indigo-600 text-white px-3 py-1 rounded-full font-bold">+ ì¶”ê°€</button>
                    </div>
                    <div id="edit-list" class="space-y-2 pb-20"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let state = {
            routines: JSON.parse(localStorage.getItem('routines')) || [
                { time: "06:00", task: "ê¸°ìƒ ë° ì•„ì¹¨ ìƒ¤ì›Œ ğŸš¿" },
                { time: "06:30", task: "ì•„ì¹¨ ì‹ì‚¬ ğŸ" },
                { time: "07:00", task: "ì˜ë‹¨ì–´ ë° ìŠ¤íŠ¸ë ˆì¹­" },
                { time: "08:40", task: "êµ­ì–´ ì‹¤ì „ ëª¨ì˜" },
                { time: "10:20", task: "ìˆ˜í•™ ì§‘ì¤‘ ë¬¸í’€" },
                { time: "12:30", task: "ì ì‹¬ ì‹ì‚¬ ë° íœ´ì‹ ğŸ±" },
                { time: "13:30", task: "ì˜ì–´ ë…í•´" },
                { time: "15:30", task: "íƒêµ¬ ì˜ì—­ 1ï¸âƒ£" },
                { time: "16:40", task: "íƒêµ¬ ì˜ì—­ 2ï¸âƒ£" },
                { time: "17:50", task: "ìˆ˜í•™ ì·¨ì•½ ë³´ê°•" },
                { time: "18:50", task: "ì €ë… ì‹ì‚¬ ë° íœ´ì‹ ğŸ—" },
                { time: "19:50", task: "ì˜¤ë‹µ ì •ë¦¬" },
                { time: "21:00", task: "ìš´ë™ (30ë¶„ ì§‘ì¤‘) ğŸƒâ€â™‚ï¸" },
                { time: "21:30", task: "ì €ë… ìƒ¤ì›Œ ë° ëª…ìƒ ğŸ›" },
                { time: "22:20", task: "ì·¨ì¹¨ ì¤€ë¹„ ë° ì·¨ì¹¨ ğŸ˜´" }
            ],
            schedules: JSON.parse(localStorage.getItem('schedules')) || [{title: "2026 ìˆ˜ëŠ¥", date: "2026-11-19"}],
            essentials: JSON.parse(localStorage.getItem('essentials')) || ["ì˜ì–‘ì œ", "ë¬¼ ë§ˆì‹œê¸°", "ìŠ¤ë§ˆíŠ¸í° ì •ë¦¬"],
            history: JSON.parse(localStorage.getItem('history')) || {},
            examDate: localStorage.getItem('examDate') || "2026-11-19",
            checks: JSON.parse(localStorage.getItem('checks')) || {},
            restDays: JSON.parse(localStorage.getItem('restDays')) || {}, 
            activeTab: 'today'
        };

        function getMidnightDate(dateObj) {
            return new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate(), 0, 0, 0, 0);
        }

        function parseDateStr(str) {
            const [y, m, d] = str.split('-').map(Number);
            return new Date(y, m - 1, d, 0, 0, 0, 0);
        }

        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        window.onload = () => { 
            renderAll(); 
            setInterval(() => { if(state.activeTab === 'today') renderRoutine(); }, 60000); 
        };

        function renderAll() {
            updateHeader();
            renderEssentials();
            if (state.activeTab === 'today') renderRoutine();
            else if (state.activeTab === 'stats') renderStats();
            else renderEdit();
        }

        function updateHeader() {
            const now = new Date();
            const todayMidnight = getMidnightDate(now);
            const tomorrowMidnight = new Date(todayMidnight.getTime() + (24 * 60 * 60 * 1000));
            const todayStr = formatDate(todayMidnight);
            const tomorrowStr = formatDate(tomorrowMidnight);
            document.getElementById('today-date-display').innerText = todayMidnight.toLocaleDateString('ko-KR', { month:'long', day:'numeric', weekday:'short' });
            const targetDate = parseDateStr(state.examDate);
            const diffDays = Math.round((targetDate - todayMidnight) / (1000 * 60 * 60 * 24));
            document.getElementById('d-day-display').innerText = diffDays > 0 ? `D-${diffDays}` : (diffDays === 0 ? "D-Day" : "D+"+Math.abs(diffDays));
            const todayEvent = state.schedules.find(s => s.date === todayStr);
            const tomorrowEvent = state.schedules.find(s => s.date === tomorrowStr);
            const header = document.getElementById('header-section');
            const alertMsg = document.getElementById('header-alert-msg');
            const eventTag = document.getElementById('event-tag');
            if (todayEvent) {
                header.classList.add('urgent-bg');
                alertMsg.classList.remove('hidden');
                eventTag.classList.remove('hidden');
                alertMsg.innerHTML = `ğŸš¨ <b>TODAY:</b> ${todayEvent.title}`;
            } else if (tomorrowEvent) {
                header.classList.add('urgent-bg');
                alertMsg.classList.remove('hidden');
                eventTag.classList.remove('hidden');
                alertMsg.innerHTML = `âš ï¸ <b>ë‚´ì¼ ì¼ì •:</b> ${tomorrowEvent.title}`;
            } else {
                header.classList.remove('urgent-bg');
                alertMsg.classList.add('hidden');
                eventTag.classList.add('hidden');
            }
        }

        function renderEssentials() {
            const list = document.getElementById('essentials-list');
            const today = formatDate(new Date());
            list.innerHTML = state.essentials.map((item, i) => {
                const checked = state.checks[`${today}-e-${i}`];
                return `
                    <div class="flex items-center justify-between bg-white/10 rounded-lg px-2 py-1.5 transition-all">
                        <div onclick="toggleEssential(${i})" class="flex items-center gap-2 flex-1 cursor-pointer overflow-hidden">
                            <div class="min-w-[12px] h-[12px] rounded-sm border border-white/40 flex items-center justify-center ${checked ? 'bg-white text-indigo-900' : ''}">
                                ${checked ? '<span class="text-[8px] font-black">âœ“</span>' : ''}
                            </div>
                            <span class="text-[11px] font-bold truncate ${checked ? 'checked opacity-50' : ''}">${item}</span>
                        </div>
                        <button onclick="deleteEssential(${i})" class="text-[10px] opacity-40 px-1">Ã—</button>
                    </div>
                `;
            }).join('');
        }

        function renderRoutine() {
            const today = formatDate(new Date());
            const container = document.getElementById('routine-list');
            const restView = document.getElementById('rest-view');
            const statusMsg = document.getElementById('status-msg');
            const restBtn = document.getElementById('rest-btn');
            if (state.restDays[today]) {
                container.classList.add('hidden');
                restView.classList.remove('hidden');
                statusMsg.innerHTML = "â˜•ï¸ ì˜¤ëŠ˜ì€ íœ´ì‹ì¼ì…ë‹ˆë‹¤.";
                restBtn.innerText = "íœ´ì‹ ì·¨ì†Œ";
                restBtn.classList.add('bg-rose-500');
                return;
            } else {
                container.classList.remove('hidden');
                restView.classList.add('hidden');
                restBtn.innerText = "ì „ì²´ íœ´ì‹";
                restBtn.classList.remove('bg-rose-500');
            }
            const now = new Date();
            const curTime = now.getHours() * 60 + now.getMinutes();
            let statusText = "â˜•ï¸ ì§€ê¸ˆì€ íœ´ì‹ ì¤‘";
            container.innerHTML = state.routines.map((item, i) => {
                const [h, m] = item.time.split(':').map(Number);
                const isChecked = state.checks[`${today}-r-${i}`];
                const taskTime = h * 60 + m;
                const nextTimeStr = (i < state.routines.length - 1) ? state.routines[i+1].time : "23:59";
                const [nh, nm] = nextTimeStr.split(':').map(Number);
                const isActive = curTime >= taskTime && curTime < (nh * 60 + nm);
                if (isActive) statusText = `ğŸ”¥ ì§€ê¸ˆì€ <span class="underline ml-1">${item.task}</span> ì‹œê°„!`;
                return `
                    <div class="flex items-center justify-between p-4 rounded-2xl bg-white border transition-all ${isActive ? 'active-task ring-4 ring-indigo-50' : 'border-slate-100'}">
                        <div class="flex items-center gap-4 flex-1 cursor-pointer" onclick="toggleRoutine(${i})">
                            <span class="text-[10px] font-black ${isActive ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'} px-2 py-1 rounded-lg font-mono">${item.time}</span>
                            <span class="text-[14px] font-bold ${isChecked ? 'checked text-slate-400' : 'text-slate-800'}">${item.task}</span>
                        </div>
                        <div onclick="toggleRoutine(${i})" class="w-8 h-8 rounded-xl border-2 flex items-center justify-center ${isChecked ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-slate-200'}">
                            ${isChecked ? 'âœ“' : ''}
                        </div>
                    </div>
                `;
            }).join('');
            statusMsg.innerHTML = statusText;
        }

        function toggleRestDay() { state.restDays[formatDate(new Date())] = !state.restDays[formatDate(new Date())]; save(); renderRoutine(); }
        function toggleEssential(i) { const key = `${formatDate(new Date())}-e-${i}`; state.checks[key] = !state.checks[key]; save(); renderEssentials(); }
        function toggleRoutine(i) { const today = formatDate(new Date()); if (state.restDays[today]) return; const key = `${today}-r-${i}`; state.checks[key] = !state.checks[key]; save(); updateHistory(); renderRoutine(); }
        
        function switchTab(tab) {
            state.activeTab = tab;
            
            // íƒ­ ì½˜í…ì¸  ë³€ê²½
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`content-${tab}`).classList.add('active');
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('tab-inactive');
            
            renderAll();
        }

        function renderStats() {
            const chart = document.getElementById('weekly-chart');
            const dates = Array.from({length: 7}, (_, i) => { const d = new Date(); d.setDate(d.getDate() - (6-i)); return formatDate(d); });
            chart.innerHTML = dates.map(date => {
                const rate = state.history[date] || 0;
                return `
                    <div class="flex-1 flex flex-col items-center gap-2">
                        <div class="w-full bg-slate-50 rounded-t-lg relative h-24 flex items-end">
                            <div class="w-full bg-indigo-500 rounded-t-lg transition-all" style="height: ${rate}%"></div>
                            <span class="absolute -top-5 w-full text-center text-[8px] font-bold text-indigo-600">${rate}%</span>
                        </div>
                        <span class="text-[9px] font-bold text-slate-400">${date.slice(8,10)}</span>
                    </div>
                `;
            }).join('');
            const rates = Object.values(state.history);
            document.getElementById('avg-rate').innerText = `${rates.length ? Math.round(rates.reduce((a,b)=>a+b, 0) / rates.length) : 0}%`;
        }

        function renderEdit() {
            const editList = document.getElementById('edit-list');
            editList.innerHTML = state.routines.map((item, i) => `
                <div class="flex items-center gap-2 bg-white p-2 rounded-xl border border-slate-200">
                    <input type="time" value="${item.time}" onchange="editRoutine(${i}, 'time', this.value)" class="bg-slate-50 rounded px-1 text-[11px] font-black h-8 w-20 text-center font-mono text-indigo-700">
                    <input type="text" value="${item.task}" onchange="editRoutine(${i}, 'task', this.value)" class="flex-1 bg-transparent text-sm font-bold outline-none px-1">
                    <button onclick="deleteRoutine(${i})" class="text-slate-300 px-3">Ã—</button>
                </div>
            `).join('');
            const scheduleList = document.getElementById('full-schedule-list');
            scheduleList.innerHTML = state.schedules.map((s, i) => `
                <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-100">
                    <div><p class="text-[9px] text-indigo-500 font-black">${s.date}</p><p class="text-sm font-bold text-slate-700">${s.title}</p></div>
                    <button onclick="deleteSchedule(${i})" class="text-xs text-red-400 font-bold">ì‚­ì œ</button>
                </div>
            `).join('');
        }

        function addSchedule() {
            const title = prompt("ì¼ì • ë‚´ìš©:");
            const date = prompt("ë‚ ì§œ (YYYY-MM-DD):", formatDate(new Date()));
            if(title && date && /^\d{4}-\d{2}-\d{2}$/.test(date)) { state.schedules.push({title, date}); state.schedules.sort((a,b) => a.date.localeCompare(b.date)); save(); renderEdit(); updateHeader(); }
        }
        function deleteSchedule(i) { state.schedules.splice(i, 1); save(); renderEdit(); updateHeader(); }
        function editRoutine(i, key, val) { state.routines[i][key] = val; state.routines.sort((a,b)=>a.time.localeCompare(b.time)); save(); renderEdit(); }
        function addNewRoutine() { state.routines.push({time: "12:00", task: "ìƒˆ ë£¨í‹´"}); save(); renderEdit(); }
        function deleteRoutine(i) { state.routines.splice(i,1); save(); renderEdit(); }
        function addNewEssential() { const t = prompt("í•  ì¼:"); if(t) { state.essentials.push(t); save(); renderEssentials(); } }
        function deleteEssential(i) { state.essentials.splice(i, 1); save(); renderEssentials(); }
        function setExamDate() { const d = prompt("ëª©í‘œ ë‚ ì§œ (YYYY-MM-DD):", state.examDate); if(d && /^\d{4}-\d{2}-\d{2}$/.test(d)) { state.examDate = d; save(); updateHeader(); } }
        function save() { localStorage.setItem('routines', JSON.stringify(state.routines)); localStorage.setItem('essentials', JSON.stringify(state.essentials)); localStorage.setItem('schedules', JSON.stringify(state.schedules)); localStorage.setItem('history', JSON.stringify(state.history)); localStorage.setItem('checks', JSON.stringify(state.checks)); localStorage.setItem('restDays', JSON.stringify(state.restDays)); localStorage.setItem('examDate', state.examDate); }
        function updateHistory() { const today = formatDate(new Date()); const done = state.routines.filter((_, i) => state.checks[`${today}-r-${i}`]).length; state.history[today] = Math.round((done / state.routines.length) * 100); save(); }
    </script>
</body>
</html>
